const std = @import("std");

pub fn build(b: *std.Build) void {
    const target = b.standardTargetOptions(.{});
    const optimize = b.standardOptimizeOption(.{});

    const foundationlibc_dep = b.dependency("foundation_libc", .{
        .target = target,
        .optimize = optimize,
        .single_threaded = true,
    });

    const arithmetic_lib = b.addModule("arithmetic_lib", .{
        .target = target,
        .optimize = optimize,
    });

    // Link libc
    arithmetic_lib.linkLibrary(foundationlibc_dep.artifact("foundation"));

    // const freertos_kernel_dep = b.dependency("freertos_kernel", .{});
    // const freertos_kernel_community_dep = b.dependency("freertos_kernel_community", .{});

    // Add FreeRTOS kernel source files
    // arithmetic_lib.addCSourceFiles(.{
    //     .root = freertos_kernel_dep.path("."),
    //     .files = &files,
    //     .flags = &flags,
    // });

    arithmetic_lib.addCSourceFiles(.{ .root = b.path("c") });

    // FreeRTOS include paths
    // arithmetic_lib.addIncludePath(freertos_kernel_dep.path("include"))

    arithmetic_lib.addIncludePath(b.path("c"));

    // arithmetic_lib.addCSourceFiles(.{
    //     .root = freertos_kernel_dep.path("./portable/ThirdParty/GCC/RP2040/"),
    //     .files = &[_][]const u8{"port.c"},
    //     .flags = &flags,
    // });

    // arithmetic_lib.addIncludePath(b.path("config/RP2040/"));
    // arithmetic_lib.addIncludePath(freertos_kernel_dep.path("./portable/ThirdParty/GCC/RP2040/include/"));

    const mod = b.addModule("arithmetic", .{ .root_source_file = b.path("src/root.zig"), .target = target, .optimize = optimize });
    mod.addImport("arithmetic_lib", arithmetic_lib);
}
